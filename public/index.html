<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Login & Register</title>
  </head>
  <body>
    <h1>Sign in</h1>
    <form id="loginForm">
      <input name="email" type="email" placeholder="email" required />
      <input name="password" type="password" placeholder="password" required />
      <button type="submit">Sign in</button>
    </form>

    <hr />

    <h2>Register new user</h2>
    <form id="registerForm">
      <input name="fullName" placeholder="Full Name" required />
      <input name="email" type="email" placeholder="Email" required />
      <input name="password" type="password" placeholder="Password" required />
      <select name="userType" required>
        <option value="">-- Select user type --</option>
        <option value="admin">Admin</option>
        <option value="member">Member</option>
        <option value="guest">Guest</option>
      </select>
      <button type="submit">Register</button>
    </form>

    <script>
      // LOGIN
      document
        .getElementById("loginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const form = e.target;
          const body = {
            email: form.email.value,
            password: form.password.value,
          };
          try {
            const r = await fetch("/auth/login", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(body),
            });
            if (r.ok) {
              const j = await r.json();
              alert("Login successful!");
              // e.g. store token or redirect
              localStorage.setItem("token", j.token);
              location.href = "/data.html";
            } else {
              const err = await r.json();
              alert("Login failed: " + (err.message || "Unknown error"));
            }
          } catch (err) {
            alert("Network error: " + err.message);
          }
        });

      // REGISTER
      document
        .getElementById("registerForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const form = e.target;
          const body = {
            fullName: form.fullName.value,
            email: form.email.value,
            password: form.password.value,
            userType: form.userType.value,
          };
          try {
            const r = await fetch("/auth/register", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(body),
            });
            if (r.ok) {
              const j = await r.json();
              alert("Registered successfully!");
              // e.g. store token or auto-login
              // localStorage.setItem("token", j.token);
              //location.href = "/app";
            } else {
              const err = await r.json();
              alert("Registration failed: " + (err.message || "Unknown error"));
            }
          } catch (err) {
            alert("Network error: " + err.message);
          }
        });
    </script>
  </body>
</html>
